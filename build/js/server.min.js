define(["./planes/pegsPlane","./planes/cannonPlane","./planes/chutesPlane","./planes/cannonBallPlane","./pegPhysicsManager","./gameModel"],function(n,e,s,t,a,i){function h(h,l){this.gameModel=new i(h,l),this.pegsPlane=new n(this,this.gameModel),this.cannonBallPlane=new t(this,this.gameModel),this.cannonPlane=new e(this,this.gameModel),this.chutesPlane=new s(this,this.gameModel),this.pegPhysicsManager=new a(this.gameModel),this.onRoundOver=function(){}}return h.prototype.init=function(){this.pegPhysicsManager.init(),this.chutesPlane.init(),this.cannonBallPlane.init(),this.cannonPlane.init(),this.pegsPlane.init();for(var n=[],e=0;200>e;e+=50)n.push({x:62,y:201+e}),n.push({x:101,y:178+e}),n.push({x:145,y:173+e}),n.push({x:188,y:184+e}),n.push({x:226,y:207+e}),n.push({x:262,y:224+e}),n.push({x:301,y:235+e}),n.push({x:345,y:231+e}),n.push({x:380,y:213+e});this.pegsPlane.loadPegs(n)},h.prototype.fireCannon=function(){this.cannonBallPlane.fireCannonBall()},h.prototype.roundOver=function(){this.pegPhysicsManager.roundOver(!1),this.cannonPlane.roundOver(!1),this.chutesPlane.roundOver(!1),this.pegsPlane.roundOver(!1),this.cannonBallPlane.roundOver(!1),this.pegPhysicsManager.roundOver(!0),this.cannonPlane.roundOver(!0),this.chutesPlane.roundOver(!0),this.pegsPlane.roundOver(!0),this.cannonBallPlane.roundOver(!0),this.onRoundOver()},h.prototype.tick=function(){this.pegPhysicsManager.tick(),this.cannonPlane.tick(),this.chutesPlane.tick(),this.pegsPlane.tick(),this.cannonBallPlane.tick()},h.extend(Object)});
define([],function(){function n(n,t){this.boardWidth=n,this.boardHeight=t,this.pegs=[],this.cannonLocation={x:this.boardWidth/2,y:0},this.cannonAngle=0,this.jackpotScore=0,this.numberOfCoins=2567,this.numberOfPulls=15,this.interRoundBonus=0}return n.extend(Object)});
define([],function(){function e(e){this.world=void 0,this.gameModel=e}var t=Box2D.Common.Math.b2Vec2,i=Box2D.Dynamics.b2BodyDef,o=Box2D.Dynamics.b2Body,r=Box2D.Dynamics.b2FixtureDef,s=(Box2D.Dynamics.b2Fixture,Box2D.Dynamics.b2World),a=(Box2D.Collision.Shapes.b2MassData,Box2D.Collision.Shapes.b2PolygonShape),n=Box2D.Collision.Shapes.b2CircleShape,l=(Box2D.Dynamics.b2DebugDraw,Box2D.Dynamics.b2ContactListener);return e.prototype.init=function(){this.world=new s(new t(0,35),!0),this.createRectangleWall(0,-this.gameModel.boardHeight,1,2*this.gameModel.boardHeight,"wall"),this.createRectangleWall(this.gameModel.boardWidth,-this.gameModel.boardHeight,1,2*this.gameModel.boardHeight,"wall"),this.createRectangleWall(0,this.gameModel.boardHeight,this.gameModel.boardWidth,1,"wall"),this.collisions=[];var e=new l;e.BeginContact=function(e){e.GetFixtureA().GetBody().GetUserData()&&e.GetFixtureA().GetBody().GetUserData().collide&&this.collisions.push({objA:e.GetFixtureA().GetBody().GetUserData(),objB:e.GetFixtureB().GetBody().GetUserData()}),e.GetFixtureB().GetBody().GetUserData()&&e.GetFixtureB().GetBody().GetUserData().collide&&this.collisions.push({objA:e.GetFixtureB().GetBody().GetUserData(),objB:e.GetFixtureA().GetBody().GetUserData()})}.bind(this),this.world.SetContactListener(e)},e.prototype.tick=function(){this.collisions=[],this.world.Step(1/60,10,10),this.world.ClearForces();for(var e=0;e<this.collisions.length;e++){var t=this.collisions[e];t.objA.collide(t.objB)}},e.prototype.roundOver=function(){},e.prototype.createRectangleWall=function(e,t,s,n,l){var h=new r;h.density=1,h.friction=1,h.restitution=.6;var p=new i;p.type=o.b2_staticBody,p.position.x=this.pixelToMeter(e)+this.pixelToMeter(s)/2,p.position.y=this.pixelToMeter(t)+this.pixelToMeter(n)/2,h.shape=new a,h.shape.SetAsBox(this.pixelToMeter(s)/2,this.pixelToMeter(n)/2);var d=this.world.CreateBody(p);return d.CreateFixture(h),d.SetUserData(l),d},e.prototype.createRectangleSensor=function(e,t,s,n,l){var h=new r;h.density=1,h.friction=1,h.restitution=.6;var p=new i;p.type=o.b2_staticBody,p.position.x=this.pixelToMeter(e)+this.pixelToMeter(s)/2,p.position.y=this.pixelToMeter(t)+this.pixelToMeter(n)/2,h.shape=new a,h.shape.SetAsBox(this.pixelToMeter(s)/2,this.pixelToMeter(n)/2);var d=this.world.CreateBody(p),c=d.CreateFixture(h);return c.SetSensor(!0),d.SetUserData(l),d},e.prototype.createCircleWall=function(e,t,s,a){var l=new r;l.density=1,l.friction=1,l.restitution=.6;var h=new i;h.type=o.b2_staticBody,l.shape=new n(this.pixelToMeter(s)),h.position.x=this.pixelToMeter(e),h.position.y=this.pixelToMeter(t);var p=this.world.CreateBody(h);return p.CreateFixture(l),p.SetUserData(a),p},e.prototype.createPeg=function(e,t,s){var a=new r;a.density=1,a.friction=1,a.restitution=.6;var l=new i;l.type=o.b2_staticBody,a.shape=new n(.5),l.position.x=this.pixelToMeter(e),l.position.y=this.pixelToMeter(t);var h=this.world.CreateBody(l);return h.CreateFixture(a),h.SetUserData(s),h},e.prototype.destroyBody=function(e){this.world.DestroyBody(e)},e.prototype.createCannonBall=function(e,s,a,l,h){var p=Math.cos(a*Math.PI/180)*l,d=Math.sin(a*Math.PI/180)*l,c=9*Math.cos(a*Math.PI/180)*16,y=3*Math.sin(a*Math.PI/180)*16,x=new r;x.density=1,x.friction=1,x.restitution=.6;var u=new i;u.type=o.b2_dynamicBody,x.shape=new n(.625),u.position.x=this.pixelToMeter(e+c),u.position.y=this.pixelToMeter(s+y);var M=this.world.CreateBody(u);return M.CreateFixture(x),M.SetUserData(h),M.ApplyImpulse(new t(p,d),M.GetWorldCenter()),M},e.prototype.meterToPixel=function(e){return e*this.getMeterPixelSize()},e.prototype.pixelToMeter=function(e){return e/this.getMeterPixelSize()},e.prototype.getMeterPixelSize=function(){return 16},e.prototype.getBoardWidthInMeters=function(){return this.gameModel.boardWidth/this.getMeterPixelSize()},e.prototype.getBoardHeightInMeters=function(){return this.gameModel.boardHeight/this.getMeterPixelSize()},e.extend(Object)});
define([],function(){Function.prototype.extend=function(t){var r=this,o=r;if(t!=Object){o=function(t,r){return function(){this.$super=r.prototype.constructor.bind(this);var o=t.prototype.constructor.apply(this,arguments);return this.$super=null,o}}(r,t),o.prototype=r.prototype,r=o;for(var e in t.prototype)r.prototype[e]?!function(t,r,o){var e=r.prototype[t];r.prototype[t]=function(){var r=this.$super;this.$super=o.prototype[t].bind(this);var n=e.apply(this,arguments);return this.$super=r,n}}(e,r,t):!function(t,r,o){r.prototype[t]=function(){var r=this.$super;return this.$super=null,ret=o.prototype[t].apply(this,arguments),this.$super=r,ret}}(e,r,t)}return o.prototype.base=t,o.prototype.instanceOf||(o.prototype.instanceOf=function(t){return this instanceof t?!0:this.base===t?!0:void 0}),o}});
define([],function(){function n(n,t){this.gameModel=n,this.cannonAsset=void 0,this.canonPlane=t,this.movingCannon=!1}return n.prototype.init=function(){},n.prototype.tick=function(){},n.extend(Object)});
define(["./peg","./chute"],function(t,e){function i(t,e,i,s,o){this.gameBoard=t,this.gameModel=e,this.x=i,this.y=s,this.angle=o,this.velocity=25,this.body=void 0,this.ballDead=!1}return i.prototype.init=function(){this.body=this.gameBoard.pegPhysicsManager.createCannonBall(this.x,this.y,this.angle,this.velocity,this)},i.prototype.tick=function(){this.body.IsAwake()||(this.ballDead=!0,this.gameBoard.pegPhysicsManager.destroyBody(this.body),this.gameBoard.roundOver())},i.prototype.collide=function(i){"string"!=typeof i&&(i.instanceOf(t)&&i.trigger(),i.instanceOf(e)&&(this.gameBoard.pegPhysicsManager.destroyBody(this.body),this.ballDead=!0,i.triggered=!0,this.gameBoard.roundOver()))},i.extend(Object)});
define([],function(){function t(t,i,e,n){this.gameModel=t,this.chuteAssets=[],this.chuteAssetsLit=[],this.chuteIndex=e,this.chutePlane=i,this.chuteLocation=n,this.triggered=!1,this.blinking=!1,this.ticking=0,this.chuteNumber=parseInt(30*Math.random())}return t.prototype.init=function(){},t.prototype.roundOver=function(t){t?(this.triggered=!1,this.blinking=!1,this.chuteNumber=parseInt(30*Math.random())):this.triggered&&(this.blinking=!0)},t.prototype.tick=function(){},t.extend(Object)});
define([],function(){function t(t,i,s,o){this.x=s,this.y=o,this.hit=!1,this.gameBoard=t,this.gameModel=i,this.body=void 0,this.bonus=parseInt(400*Math.random()),this.ticking=void 0,this.tocking=0,this.blinking=!1}return t.prototype.init=function(){this.body=this.gameBoard.pegPhysicsManager.createPeg(this.x,this.y,this)},t.prototype.trigger=function(){this.hit||(this.gameModel.interRoundBonus+=this.bonus,this.hit=!0,this.ticking=50)},t.prototype.destroy=function(){this.gameBoard.pegPhysicsManager.destroyBody(this.body)},t.prototype.roundOver=function(t){this.hit&&(t?this.destroy():this.blinking=!0)},t.extend(Object)});
define(["../pieces/cannonBall"],function(n){function o(o,t){this.plane=void 0,this.gameBoard=o,this.gameModel=t,this.cannonBall=void 0,this.cannonBallInstance=n}return o.prototype.init=function(){},o.prototype.roundOver=function(n){n&&(this.cannonBall=void 0)},o.prototype.tick=function(){this.cannonBall&&this.cannonBall.tick()},o.prototype.fireCannonBall=function(){this.cannonBall||(this.cannonBall=new this.cannonBallInstance(this.gameBoard,this.gameModel,this.gameModel.cannonLocation.x,this.gameModel.cannonLocation.y,this.gameModel.cannonAngle+90),this.cannonBall.init())},o.extend(Object)});
define(["../pieces/cannon"],function(n){function t(t,o){this.plane=void 0,this.gameModel=o,this.gameBoard=t,this.cannon=new n(this.gameModel,this)}return t.prototype.init=function(){this.cannon.init()},t.prototype.roundOver=function(n){n&&(this.gameModel.cannonAngle=0)},t.prototype.tick=function(){this.cannon.tick()},t.prototype.shootBall=function(){this.gameBoard.fireCannon()},t.extend(Object)});
define(["../pieces/chute"],function(e){function t(t,i){this.backPlane=void 0,this.frontPlane=void 0,this.gameModel=i,this.gameBoard=t,this.bumpersSize=void 0,this.bucketsSize=void 0,this.chutes=[],this.chuteInstance=e}return t.prototype.init=function(){this.bumpersSize={width:434,height:65},this.bucketsSize={width:399,height:47};for(var e=[],t=14,i=55,h=this.bucketsSize.height,s=31,a=18,r=0;5>r;r++){var g=a+r*(i+s);e.push({x:g,y:this.gameBoard.gameModel.boardHeight-this.bucketsSize.height})}var o=[];o.push({x:0,y:this.gameBoard.gameModel.boardHeight-(this.bumpersSize.height-t),width:a,height:this.bumpersSize.height-t,circleX:0});for(var r=1;5>r;r++){var g=a+i*r+s*(r-1);o.push({x:g,y:this.gameBoard.gameModel.boardHeight-(this.bumpersSize.height-t),width:s,height:this.bumpersSize.height-t,circleX:g+s/2})}o.push({x:a+5*i+4*s,y:this.gameBoard.gameModel.boardHeight-(this.bumpersSize.height-t),width:a,height:this.bumpersSize.height-t,circleX:this.gameBoard.gameModel.boardWidth});for(var r=0;r<e.length;r++){var c=e[r],d=new this.chuteInstance(this.gameModel,this,r,c);d.init(),this.gameBoard.pegPhysicsManager.createRectangleSensor(c.x,c.y,i,h,d),this.chutes.push(d)}for(var r=0;r<o.length;r++){var n=o[r];this.gameBoard.pegPhysicsManager.createRectangleWall(n.x,n.y,n.width,n.height,"wall"),this.gameBoard.pegPhysicsManager.createCircleWall(n.circleX,n.y,t,"wall")}},t.prototype.roundOver=function(e){for(var t=0;t<this.chutes.length;t++){var i=this.chutes[t];i.roundOver(e)}},t.prototype.tick=function(){},t.extend(Object)});
define(["../pieces/peg"],function(e){function t(t,o){this.gameModel=o,this.gameBoard=t,this.pegInstance=e}return t.prototype.init=function(){},t.prototype.roundOver=function(e){for(var t=this.gameModel.pegs.length-1;t>=0;t--){var o=this.gameModel.pegs[t];o.roundOver(e),e&&o.hit&&this.gameModel.pegs.splice(t,1)}},t.prototype.loadPegs=function(e){this.gameModel.pegs=[];for(var t=0;t<e.length;t++){var o,i=e[t];this.gameModel.pegs.push(o=new this.pegInstance(this.gameBoard,this.gameModel,i.x,i.y)),o.init()}},t.prototype.tick=function(){},t.extend(Object)});
"function"!=typeof define&&(global.define=require("requirejs")(module)),require("../Common/utils/extender"),require("./staticHosting"),require("./game");
require("../Common/ballGame/libs/Box2dWeb-2.1.a.3.min.js"),define(["../Common/ballGame/gameBoard"],function(o){var e=require("socket.io").listen(9999);console.log("game server started");var n=[];e.sockets.on("connection",function(o){console.log("user joined"),n.push({socket:o}),e.sockets.emit("news",{foo:"bar"}),o.on("other",function(o,e){console.log(e)}),o.on("disconnect",function(){console.log("user left"),e.sockets.emit("user disconnected")})}),console.log("loaded");var s=430,c=557,i=new o(s,c);i.init();var t=!1;for(i.onRoundOver=function(){t=!0,console.log("done")},i.fireCannon();!t;)i.tick()});
var express=require("express"),http=require("http"),path=require("path"),app=express();app.set("port",3e3),app.use(express.favicon()),app.use(express.logger("dev")),app.use(express.static(path.join(__dirname,".."))),app.use(express.errorHandler()),http.createServer(app).listen(app.get("port"),function(){console.log("Express server listening on port "+app.get("port"))});